<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenido - Mi Gestor Financiero</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#4CAF50" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <script src="js/language.js"></script>
    <script src="js/themes.js"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <style>
        .welcome-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color-light, #81c784), var(--primary-color, #4CAF50));
            padding: 1rem;
        }
        
        .welcome-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }
        
        .welcome-title {
            font-size: 1.75rem;
            color: var(--primary-color, #4CAF50);
            margin-bottom: 0.5rem;
        }
        
        .welcome-subtitle {
            color: #666;
            margin-bottom: 2rem;
        }
        
        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: #fff;
            color: #333;
            border: 1px solid #ddd;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        
        .google-btn:hover {
            background-color: #f8f8f8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .google-icon {
            width: 24px;
            height: 24px;
        }
        
        .error-message {
            color: #f44336;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: none;
        }
    </style>
</head>
<body>
    <div class="welcome-container">
        <div class="welcome-card">
            <h1 class="welcome-title">Mi Gestor Financiero</h1>
            <p class="welcome-subtitle">Inicia sesión para gestionar tus finanzas</p>
            
            <button id="google-login-btn" class="google-btn">
                <img src="https://www.google.com/favicon.ico" alt="Google" class="google-icon">
                <span>Continuar con Google</span>
            </button>
            
            <p id="error-message" class="error-message"></p>
        </div>
    </div>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar si ya hay una sesión activa
            const userId = localStorage.getItem('user_id');
            const userPrefix = localStorage.getItem('current_user_prefix');
            const hasAuthType = userPrefix ? localStorage.getItem(`${userPrefix}_auth_type`) : null;
            
            if (userId && userPrefix && hasAuthType) {
                // Si ya hay una sesión y método de autenticación configurado, redirigir a pin.html
                window.location.href = 'pin.html';
                return;
            }
            
            // Configurar botón de inicio de sesión con Google
            const googleBtn = document.getElementById('google-login-btn');
            if (googleBtn) {
                googleBtn.addEventListener('click', handleGoogleLogin);
            }
        });

        // Función para manejar el inicio de sesión con Google
        function handleGoogleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    const userId = user.uid;
                    const userPrefix = `user_${userId}`;
                    
                    // Guardar información del usuario
                    localStorage.setItem('user_id', userId);
                    localStorage.setItem('user_name', user.displayName);
                    localStorage.setItem('user_email', user.email);
                    localStorage.setItem('user_photo', user.photoURL);
                    localStorage.setItem('current_user_prefix', userPrefix);

                    // Verificar si el usuario ya existe
                    const existingAuthType = localStorage.getItem(`${userPrefix}_auth_type`);
                    
                    if (existingAuthType) {
                        // Usuario existente, redirigir a pin.html
                        window.location.href = 'pin.html';
                    } else {
                        // Nuevo usuario, redirigir a opciones de seguridad
                        window.location.href = 'security-options.html';
                    }
                })
                .catch((error) => {
                    console.error('Error en autenticación:', error);
                    const errorMessage = document.getElementById('error-message');
                    errorMessage.textContent = 'Error al iniciar sesión con Google';
                    errorMessage.style.display = 'block';
                });
        }
    </script>
</body>
</html> 